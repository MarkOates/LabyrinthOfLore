properties:
  - name: font
    type: ALLEGRO_FONT*
    init_with: nullptr
    constructor_arg: true
  - name: message_scroll
    type: LabyrinthOfLore::Hud::MessageScroll*
    init_with: "{}"
    constructor_arg: true
  - name: place
    type: allegro_flare::placement3d
    init_with: "allegro_flare::placement3d{}"
    constructor_arg: true
  - name: __dirty_total_line_count
    static: true
    type: int
    init_with: 0
functions:
  - name: multiline_draw_callback
    static: true
    type: bool
    parameters:
      - name: line_num
        type: int
        default_argument: 0
      - name: line
        type: const char*
        default_argument: nullptr
      - name: size
        type: int
        default_argument: 0
      - name: extra
        type: void*
        default_argument: nullptr
    body: |
      //this functions callback signature:
      //bool (*cb)(int line_num, const char *line, int size, void *extra)

      __dirty_total_line_count++;

      ALLEGRO_FONT *font = (ALLEGRO_FONT *)extra;
      al_draw_text(font, al_color_name("gray"), 0, __dirty_total_line_count * al_get_font_line_height(font), 0, line);
      return true;
  - name: render
    type: void
    body: |
      if (!font) throw std::runtime_error("Cannot draw MessageScrollRenderer with a nullptr font");
      if (!message_scroll) throw std::runtime_error("Cannot draw MessageScrollRenderer with a nullptr message_scroll");

      place.start_transform();

      //al_draw_filled_rounded_rectangle(0, 0, place.size.x, place.size.y, 6, 6, al_color_name("red"));
      std::vector<std::pair<float, std::string>> last_3_messages = message_scroll->get_last_3_messages();

      __dirty_total_line_count = 0;
      for (unsigned i=0; i<last_3_messages.size(); i++)
      {
         std::pair<float, std::string> this_message = last_3_messages[i];
         std::string message_text = this_message.second;

         al_do_multiline_text(font, place.size.x, message_text.c_str(), LabyrinthOfLore::Rendering::Hud::MessageScrollRenderer::multiline_draw_callback, font);
      }

      place.restore_transform();
      return;
    body_dependency_symbols:
      - std::vector<std::pair<float, std::string>>
      - al_color_name
      - al_draw_rounded_rectangle
dependencies:
  - symbol: LabyrinthOfLore::Hud::MessageScroll*
    headers: [ LabyrinthOfLore/Hud/MessageScroll.hpp ]
  - symbol: ALLEGRO_FONT*
    headers: [ allegro5/allegro_font.h ]
  - symbol: al_color_name
    headers: [ allegro5/allegro_color.h ]
  - symbol: al_draw_rounded_rectangle
    headers: [ allegro5/allegro_primitives.h ]
  - symbol: allegro_flare::placement3d
    headers: [ allegro_flare/placement3d.h ]
  - symbol: x
    headers: [ y ]
  - symbol: std::vector<std::pair<float, std::string>>
    headers: [ vector, utility, string ]
  - symbol: void*
    headers: [ ]
  - symbol: const char*
    headers: [ ]
